<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title || "BVRSRS" %></title>
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Barlow:wght@300;400;500;600;700&display=swap">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>

    <link rel="stylesheet" href="/style.css">
    <link rel="icon" href="/images/logo.png">

    <style>
        .active {
            font-weight: bold;
        }
        .nav2 {
            padding: 8px;
            border-radius: 12px;
        }
        .nav2.mnav:hover {
            transform: scale(1) !important;
        }
        #subNav, #subMenu {
            margin-left: 10px;
            padding-left: 5px;
            padding-top: 5px;
            padding-bottom: 0;
            background: linear-gradient(to right, white 1px, transparent 1px);
        }
    </style>
</head>
<body>
<% if(user && (user.access === 1 || user.access === "1")) { %>

    <div class="sidef relative">
    <div class="watermark1 absolute bottom20 right20 borderRadius500 h70 w70 padding5" style="transform: scale(3); opacity: 0.03; filter: blur(0.5px) brightness(01) grayscale(0.8); background-color: rgba(255, 255, 255, 0.641);"><img src="/images/logo.jpg" class="borderRadius500" alt=""></div>
        <div class="headf">
            <div class="logo">
                <img src="/images/logo.png" class="" style="border: 0.5px solid white;">
            </div>
            <div class="logoLabel col">
                <p class="lgtitle">BVRSRS</p>
            </div>
        </div>

        <div class="menu relative">
            <a href="/" class="nav width100 transparent white borderRadius10 absolute right0 bottom10 <%= activePage === 'abt' ? 'active' : '' %>" style="opacity: 1;">
                <i class="fas fa-share-from-square"></i> LOGOUT
            </a>
            <hr>
            <a href="/dsb" class="nav mnav <%= activePage === 'dsb' ? 'active' : '' %>"><i class="bi bi-grid-fill"></i> Dashboard</a>
            <% if (user.position === "Punong Barangay" || user.position === "Barangay Secretary" || user.position === "Barangay Clerk") { %>
            <div class="height0 col menu gap0 padding0" style="padding-inline: 0.15rem;">
                <a href="#" class="width95 nav mnav relative <%= (['ovv', 'ovvB', 'ovvI', 'ovvR', 'ovvG', 'ovvC', 'srv', 'srvAll'].includes(activePage)) ? 'active' : '' %>" id="menu">
                    <i class="fas fa-file-alt"></i> Services
                    <i class="fas fa-chevron-down absolute right5"></i>
                </a>                
                <div class="height0 alignStart col colorPrimary borderRadius10 gap5 <%= ['ovv','ovr', 'trs', 'ovvB', 'ovvI', 'ovvR', 'ovvG', 'ovvC', 'srv'].includes(activePage) ? '' : 'hidden' %>  justifyStart padding15" id="subMenu">
                    <a href="/ovr" class="nav2 mnav <%= activePage === 'ovr' ? 'active' : '' %>"><i class="fas fa-chart-line"></i>Analytics</a>
                    <a href="/ovv" class="nav2 mnav hidden <%= activePage === 'ovv' ? 'active' : '' %>"><i class="fas fa-bar-chart"></i>Overview</a>
                    <a href="/srv" class="nav2 mnav <%= activePage === 'trs' ? 'active' : '' %>"><i class="fas fa-receipt"></i>Transactions</a>
                    <a href="/ovvB" class="nav2 mnav hidden <%= activePage === 'ovvB' ? 'active' : '' %>"><i class="fas fa-file"></i> Clearance</a>
                    <a href="/ovvI" class="nav2 mnav hidden <%= activePage === 'ovvI' ? 'active' : '' %>"><i class="fas fa-hands-helping"></i> Indigency</a>
                    <a href="/ovvR" class="nav2 mnav hidden <%= activePage === 'ovvR' ? 'active' : '' %>"><i class="fas fa-location-dot"></i> Residency</a>
                    <a href="/ovvG" class="nav2 mnav hidden <%= activePage === 'ovvG' ? 'active' : '' %>"><i class="fas fa-user"></i> Good Moral</a>
                    <a href="/ovvC" class="nav2 mnav hidden <%= activePage === 'ovvC' ? 'active' : '' %>"><i class="fas fa-edit"></i> Certification</a>
                </div>
            </div>            
            <div class="height0 col menu gap0 padding0" style="padding-inline: 0.15rem;">
                <a href="#" class="width95 nav mnav relative <%= (['rsd', 'fml', 'vtr', 'hsh', 'ind'].includes(activePage)) ? 'active' : '' %>" id="nav">
                    <i class="fas fa-home"></i> Residents
                    <i class="fas fa-chevron-down absolute right5"></i>
                </a>
                <div class="height0 alignStart col colorPrimary borderRadius10 gap5 <%= ['rsd', 'hsh', 'fml', 'vtr', 'ind'].includes(activePage) ? '' : 'hidden' %> justifyStart padding15" id="subNav">
                    <a href="/hsh" class="nav2 mnav <%= activePage === 'hsh' ? 'active' : '' %>"><i class="fas fa-home-alt"></i> Households</a>
                    <a href="/fml" class="nav2 mnav <%= activePage === 'fml' ? 'active' : '' %>"><i class="fas fa-baby"></i> Families</a>
                    <a href="/rsd" class="nav2 mnav <%= activePage === 'rsd' ? 'active' : '' %>"><i class="fas fa-user"></i> Inhabitants</a>
                    <a href="/vtr" class="nav2 mnav <%= activePage === 'vtr' ? 'active' : '' %>"><i class="fas fa-stamp"></i> Voters List</a>
                    <a href="/ind" class="nav2 mnav <%= activePage === 'ind' ? 'active' : '' %>"><i class="fas fa-hands-holding"></i> Indigent</a>
                </div>                
            </div>
            <% } %>
            <% if (user.position !== "Punong Barangay" && user.position !== "Barangay Secretary" && user.position !== "Barangay Clerk") { %>
                <a href="/rqt" class="nav mnav <%= activePage === 'rqt' ? 'active' : '' %>">
                    <i class="fas fa-file"></i> Request
                </a>           
            <div class="height0 col menu gap0 padding0" style="padding-inline: 0.15rem;">
                <a href="#" class="width95 nav mnav relative <%= (['rsd', 'fml', 'vtr', 'hsh'].includes(activePage)) ? 'active' : '' %>" id="xtr">
                    <i class="fas fa-home"></i> Residents
                    <i class="fas fa-chevron-down absolute right10"></i>
                </a>
                <div class="height0 alignStart col colorPrimary borderRadius10 gap5 <%= ['rsd', 'hsh', 'fml', 'vtr'].includes(activePage) ? '' : 'hidden' %> justifyStart padding15" id="xtrDiv">
                    <a href="/rsd" class="nav2 mnav <%= activePage === 'rsd' ? 'active' : '' %>"><i class="fas fa-user"></i> Inhabitants</a>
                    <a href="/hsh" class="nav2 mnav <%= activePage === 'hsh' ? 'active' : '' %>"><i class="fas fa-home-alt"></i> Households</a>
                    <a href="/fml" class="nav2 mnav <%= activePage === 'fml' ? 'active' : '' %>"><i class="fas fa-baby"></i> Families</a>
                    <a href="/vtr" class="nav2 mnav <%= activePage === 'vtr' ? 'active' : '' %>"><i class="fas fa-stamp"></i> Voters List</a>
                </div>                
            </div>
            <% } %> 

            <a href="/bus" class="nav mnav <%= activePage === 'bus' ? 'active' : '' %>"><i class="fas fa-building"></i> Business</a>
            <% if (user.position === "Punong Barangay" || user.position === "Barangay Secretary" || user.position === "Barangay Clerk") { %>
            <a href="/cmp" class="nav mnav <%= activePage === 'cmp' ? 'active' : '' %>"><i class="fas fa-balance-scale"></i> Pending Cases</a>
            <% } %>
            <a href="/ann" class="nav mnav <%= activePage === 'ann' ? 'active' : '' %>"><i class="fas fa-bullhorn"></i> Announcements</a>
            <a href="/htl" class="nav mnav <%= activePage === 'htl' ? 'active' : '' %>"><i class="fas fa-phone"></i> Hotlines</a>
        </div>

        <div class="menu justifyEnd" style="height: 10%; padding: 0;">
            <div class="borderRadius15" style="height: 65px !important; justify-content: start; z-index: 50 !important; background-color: rgba(255, 255, 255, 0.1);">
                <div class="logo">
                    <a href="/rsdView/<%= user._id %>" id="prf" style="border: 1px solid white; border-radius: 50%; padding: 5px; background-color: transparent">
                        <img src="<%= user.photo ? user.photo : '/images/profile.jpg' %> " alt="Profile Image" onerror="this.onerror=null; this.src='/images/profile.jpg';">
                    </a>
                </div>
                <div class="height0 col width0 alignStart">
                        <p class="size16 str400 hidden">Welcome</p>
                        <p class="size14 str300"><%= user.position %></p>
                </div>
            </div>
        </div>
    </div>

    <div class="mainf">
        <div class="bgWhite borderPrimary height0 padding15 width0 fixed index50 right40 bottom40 borderRadius15 darkShadow hidden">
            Hello, this is a sample of a error message we need to have!
        </div>
        <%- body %>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            let menu = document.getElementById("menu");
            let subMenu = document.getElementById("subMenu");
            let nav = document.getElementById("nav");
            let subNav = document.getElementById("subNav");
            let menuChevron = menu.querySelector("i.fas.fa-chevron-down"); 
            let navChevron = nav.querySelector("i.fas.fa-chevron-down"); 
    
            function closeAll() {
                subMenu.classList.add("hidden");
                subNav.classList.add("hidden");
                menuChevron.style.transform = "rotate(0deg)";
                navChevron.style.transform = "rotate(0deg)";
            }
    
            menu.addEventListener("click", function (event) {
                event.preventDefault();
                let isMenuOpen = !subMenu.classList.contains("hidden");
    
                closeAll(); // Close both first
                if (!isMenuOpen) {
                    subMenu.classList.remove("hidden");
                    subMenu.classList.add("padding15");
                    menuChevron.style.transition = "transform 0.3s ease";
                    menuChevron.style.transform = "rotate(180deg)";
                }
                event.stopPropagation();
            });
    
            nav.addEventListener("click", function (event) {
                event.preventDefault();
                let isNavOpen = !subNav.classList.contains("hidden");
    
                closeAll(); // Close both first
                if (!isNavOpen) {
                    subNav.classList.remove("hidden");
                    subNav.classList.add("padding15");
                    navChevron.style.transition = "transform 0.3s ease";
                    navChevron.style.transform = "rotate(180deg)";
                }
                event.stopPropagation();
            });
    
            document.addEventListener("click", function (event) {
                if (!menu.contains(event.target) && !subMenu.contains(event.target) &&
                    !nav.contains(event.target) && !subNav.contains(event.target)) {
                    closeAll();
                }
            });
    
            subMenu.addEventListener("click", function (event) {
                event.stopPropagation();
            });
    
            subNav.addEventListener("click", function (event) {
                event.stopPropagation();
            });
        });
    </script>
    <script>document.addEventListener("DOMContentLoaded", function () {
        let residentsMenu = document.getElementById("xtr");
        let residentsSubMenu = document.getElementById("xtrDiv");
        let residentsChevron = residentsMenu.querySelector("i.fas.fa-chevron-down");
    
        function closeResidentsMenu() {
            residentsSubMenu.classList.add("hidden");
            residentsChevron.style.transform = "rotate(0deg)";
        }
    
        residentsMenu.addEventListener("click", function (event) {
            event.preventDefault();
            let isMenuOpen = !residentsSubMenu.classList.contains("hidden");
    
            closeResidentsMenu(); // Close first before toggling
            if (!isMenuOpen) {
                residentsSubMenu.classList.remove("hidden");
                residentsChevron.style.transition = "transform 0.3s ease";
                residentsChevron.style.transform = "rotate(180deg)";
            }
            event.stopPropagation();
        });
    
        document.addEventListener("click", function (event) {
            if (!residentsMenu.contains(event.target) && !residentsSubMenu.contains(event.target)) {
                closeResidentsMenu();
            }
        });
    
        residentsSubMenu.addEventListener("click", function (event) {
            event.stopPropagation();
        });
    });
    
    </script>

<% } %>
</body>
</html>
